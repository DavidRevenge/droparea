<!DOCTYPE HTML> 
<html lang="en"> 
<head> 
<meta http-equiv="content-type" content="text/html; charset=utf-8" /> 
<title>HTML5 Drag & Drop Uploader</title>
<meta name="description" content="HTML5 Drag & Drop Uploader" /> 
<meta name="keywords" content="html5, drag drop, uploader, sample" />
<link type="text/plain" rel="author" href="http://gokercebeci.com/humans.txt" />
<link rel="shortcut icon" href="http://gokercebeci.com/favicon.ico" type="image/x-icon" />    
<style>
body { padding: 20px 10px; color:#333; font: normal 12px sans-serif; }
#devcontainer { margin: 0 auto; width: 940px; }
</style>
<!-- jquery -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js" type="text/javascript"></script> 
</head> 
<body> 
<div id="devcontainer">
<!-- development area -->

<style> 
.droparea {
	position:relative;
	text-align: center;
	border: 2px dashed #ddd;
}		
.droparea.over {
	background: #ffa;
	border: 2px dashed #000;
}
.droparea .progress {
	position:absolute;
	bottom: 0;
	width: 100%;
	height: 0;
	color: #fff;
	background: #6b0;
}
.spot {
    margin-bottom:20px;
    width: 460px;
	height: 345px;
}
.thumb {
    float: left;
    margin-right:17px;
    width: 140px;
	height: 105px;
}
.desc {
    float:right;
    width: 460px;
}
.signature a { color:#555; text-decoration:none; }
.signature img { margin-right:5px; vertical-align: middle; }
</style> 

    <div class="desc">
    <p><b>droparea</b> is a HTML5 drag and drop image file uploader jQuery plug-in and a php script for server-side.</p>
    <p>I developed it to use on my <a href="http://edirne.in" title="edirne">Edirne</a> project.</p>
    <p>I've only tested it on Google Chrome (11.0.696.57) and Mozilla Firefox (3.6.17) and it works enough for me for now!</p>
    <p class="signature"><a href="http://gokercebeci.com/dev/" title="developer">
        <img src="http://geticon.org/of/gokercebeci.com" alt="developer" />
        goker.cebeci, the developer</a></p>
    </div>

    <div class="droparea spot" data-width="460" data-height="345" data-type="jpg" data-crop="true" data-quality="60"></div>

    <div class="droparea thumb" data-width="140" data-height="105" data-type="jpg" data-crop="true" data-quality="60"></div>
    <div class="droparea thumb" data-width="140" data-height="105" data-type="jpg" data-crop="true" data-quality="60"></div>
    <div class="droparea thumb" data-width="140" data-height="105" data-type="jpg" data-crop="true" data-quality="60"></div>


<script type="text/javascript">
(function( $ ){
	var area, s;
	// Methods
	var m = {
		traverse: function(files){
			if (typeof files !== "undefined") {
				for (var i=0, l=files.length; i<l; i++) {
					m.upload(files[i]);
				}
			} else {
				$(area).html(nosupport);
			}	
		},
		upload: function(file){
			$(area).empty();
			var progress = $('<div>',{'class':'progress'}),	xhr, requests;
			$(area).append(progress);
			
			// File type control
			if (typeof FileReader === "undefined" || !(/image/i).test(file.type)) {
				$(area).html(file.type,s.noimage); 
				alert('only image files: jpeg, png, gif');
				return false;
			}

			// File size control
			if (file.size > (s.maxsize * 1024)) {
				$(area).html(file.type,s.noimage); 
				alert('max upload size: ' + s.maxsize + 'Kb');
				return false;
			}
			
			// Uploading - for Firefox, Google Chrome and Safari
			xhr = new XMLHttpRequest();
			// Update progress bar
			xhr.upload.addEventListener("progress", function (e) {
				if (e.lengthComputable) {
					var loaded = Math.ceil((e.loaded / e.total) * 100) + "%";
					progress.css({'height':loaded}).html(loaded);
				}
			}, false);
			
			// File uploaded
			xhr.addEventListener("load", function (e) {
			    $(area).html(e.target.responseText);
				progress.addClass('uploaded');
				progress.html(s.uploaded).fadeOut('slow');
			}, false);
			
			// Set request parameters
			requests = '?width=' + $(area).data('width')
    			     + '&height=' + $(area).data('height')
    			     + '&type=' + $(area).data('type')
    			     + '&crop=' + $(area).data('crop')
    			     + '&quality=' + $(area).data('quality');
			
			xhr.open("post", s.post + requests, true); 
            
            // Set appropriate headers
		    xhr.setRequestHeader("Content-Type", "multipart/form-data");
		    xhr.setRequestHeader("X-File-Name", file.fileName);
		    xhr.setRequestHeader("X-File-Size", file.fileSize);
		    xhr.setRequestHeader("X-File-Type", file.type);

		    xhr.send(file);
		}
	};
	$.fn.droparea = function(o) {
		// Settings
	    s = {
			'instructions'	: 'drop an image file here',
			'over'			: 'drop file here!',
			'nosupport'		: 'No support for the File API in this web browser',
			'noimage'		: 'Unsupported file type!',
			'uploaded'		: 'Uploaded',
			'maxsize'		: '500', //Kb
			'post'			: 'upload.php'
	    };
		this.each(function(){
			if(o) $.extend(s, o);
		    $(this)
			    .html(s.instructions)
			    .bind({
			    dragleave: function (e) {
					e.preventDefault();
					e.stopPropagation();
					var target = e.target;
					if (target && target === area) {
						$(this).removeClass('over').html(s.instructions);
					}
				},
				dragenter: function (e) {
					e.preventDefault();
					e.stopPropagation();
					area = this;
			    	$(this).addClass('over').html(s.over);
				},
				dragover: function (e) {
					e.preventDefault();
					e.stopPropagation();
				}
			    });
			this.addEventListener("drop", function (e) {
				m.traverse(e.dataTransfer.files);
				e.preventDefault();
		    	e.stopPropagation();
				$(this).removeClass('over');
			},false);				
		});
	};
})( jQuery );

// Calling jQuery "droparea" plugin
$('.droparea').droparea();
</script>

<!-- /development area -->
</div>
</body>
</html> 
